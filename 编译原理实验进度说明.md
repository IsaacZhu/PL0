# 编译原理实验进度说明



---

2017.10.25  杨文涛

本次修改主要是对SYM_ELSE和SYM_ELSE_IF语句的补充实现。

* 添加了变量cx3，cx4，cx5。用于对各个阶段cx的储存

* 主要添加部分如下

  ```c
  	else if (sym == SYM_IF)
  	{ // if statement
  		getsym();
  		set1 = createset(SYM_THEN, SYM_DO, SYM_NULL);
  		set = uniteset(set1, fsys);
  		condition(set);
  		destroyset(set1);
  		destroyset(set);
  		if (sym == SYM_THEN)
  		{
  			getsym();
  		}
  		else
  		{
  			error(16); // 'then' expected.
  		}
  		cx1 = cx;
  		gen(JPC, 0, 0);
  		statement(fsys);
  		getsym();
  		if(sym==SYM_ELSE_IF)//add by ywt,deal with SYM_ELSE_IF,2017.10.20
          {
              getsym();
  			condition(set);//
  		    if (sym == SYM_THEN)
  		    {
  			   getsym();
  		    }
  		    else
  		    {
  			error(16); // 'then' expected.
  		    }
              cx4=cx;
              code[cx1].a=cx+1;
              gen(JPC,0,0);
              statement(fsys);
  			getsym();   
  			 if(sym==SYM_ELSE) 
             {
              getsym();
              cx5=cx;
              code[cx4].a=cx+1;
              gen(JMP,0,0);
              statement(fsys);
              code[cx5].a=cx;                                                  
             }     
  		   else
  		   code[cx4].a=cx;                                       
           }
  		else if(sym==SYM_ELSE) //add by ywt,deal with SYM_ELSE,2017.10.20
          {
              getsym();
              cx3=cx;
              code[cx1].a=cx+1;
              gen(JMP,0,0);
              statement(fsys);
              code[cx3].a=cx;                                                  
           }
  		else
  		code[cx1].a = cx;
  	}
  ```

  else语句直接使用JMP语句跳转，无需进行条件判断。

  而对于else if语句，需要考虑到结构if——else和if——else if--else，else if需要对条件进行判断，因此需要使用JPC实现，并判断接下来的语句。

* 条件短路算法遇到的问题任然没有解决，遇到的问题是，编译出的汇编代码正确，但是无法跑出正确结果，condition部分遭到破坏。现在仍然在进行更改，但对后续任务影响不大。

---

Dong Shi, 10.28

* + Add OP RET to the interpret
* + Add Procedure reserved word to factor set
* + Add Procedure handle in factor
* + Add movement of RET in statement
* + Add "break" to case OPR\_NEQ and OPR\_GEQ
* - Remove reserved word call

* ! WARNING: For allowing procedure name appear without call, I allow all factor appear without a statement. (By disabling test(facbegsys, fsys, 24) in factor)

* ! WARNING: procdure(even with return value) and constant cannot be in parameter list of another procedure

* ! WARNING: in factor, while(insert){} was changed to insert

* ! WARNING: in case RET, only one ++top left